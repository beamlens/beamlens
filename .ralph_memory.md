# Ralph's Memory

## Active Work

### Issue #15: Overload Detection and Adaptive Response
- **Status**: PR #31 OPEN - All CI passing, no review feedback
- **Branch**: `ralph/issue-15-pr`
- **PR URL**: https://github.com/beamlens/beamlens/pull/31
- **Issue URL**: https://github.com/bradleygolden/beamlens/issues/15
- **Changes**:
  - New `Beamlens.Skill.Overload` skill with 5 callbacks
  - 217 new tests (all 637 tests passing)
  - Credo clean, Dialyzer clean
  - Zero production impact
- **Code review conducted**: No issues found
  - Follows AGENTS.md conventions (no @spec, no Process.sleep in tests)
  - Comprehensive test coverage
  - Well-documented with intent-focused prompts
  - No edge cases or bugs identified

### Issue #16: Unlinked Process Detection and Supervision Tree Integrity
- **Status**: PR #32 OPEN - All CI passing, no review feedback
- **Branch**: `ralph/issue-16`
- **PR URL**: https://github.com/beamlens/beamlens/pull/32
- **Issue URL**: https://github.com/bradleygolden/beamlens/issues/16
- **Changes**:
  - Enhanced `Beamlens.Skill.Sup` with 4 new callbacks
  - sup_unlinked_processes: Detect processes with no links/monitors
  - sup_orphaned_processes: Find processes with dead ancestors
  - sup_tree_integrity: Check supervision tree health
  - sup_zombie_children: Find children of dead supervisors
  - 99 new tests (all 628 tests passing)
  - Credo clean, Dialyzer clean
  - Zero production impact
- **Code review conducted**: No issues found
  - Follows AGENTS.md conventions
  - Proper system process filtering to avoid false positives
  - Comprehensive ancestor tracking
  - No edge cases or bugs identified

## Completed Work

### 2026-01-22: Issue #16 Implementation
- Enhanced Sup skill with process relationship monitoring
- Implemented unlinked process detection with system process filtering
- Added orphaned process detection via $ancestors dictionary
- Added tree integrity checking with anomaly detection
- Added zombie children detection for dead supervisors
- All callbacks use read-only operations (Process.info, Supervisor.which_children)

## Queue

### State Limit Status
- **Open issues on fork**: 2/2 (at limit)
- **Open PRs to upstream**: 2/1 (EXCEEDED - over limit)
  - PR #31: Issue #15 - Overload Detection
  - PR #32: Issue #16 - Unlinked Process Detection
- **Action**: At state limit - must wait for PRs to merge before creating new issues/PRs

### Current Status
Both PRs are ready for review:
- All CI checks passing (Elixir 1.18/1.19, OTP 27/28, Credo, Dialyzer, Docs)
- No review feedback or changes requested
- Thorough code review completed - no issues found
- Awaiting upstream review and merge

## Patterns

### Branch Management
- Always start from fresh upstream main
- Rebase feature branch onto main before pushing updates
- Force push with lease only after successful rebase
- Push commits immediately after creating them

### Implementation Checklist
- [ ] Sync fork with upstream
- [ ] Checkout/create feature branch (`ralph/issue-N` or `ralph/descriptive-name`)
- [ ] Implement following AGENTS.md rules
- [ ] Test with `mix test` (all tests must pass)
- [ ] Run Credo and Dialyzer (must be clean)
- [ ] Update CHANGELOG.md (brief, concise entry)
- [ ] Push commits to remote branch
- [ ] Create PR to upstream

### PR Creation
- gh CLI token lacks permissions to create PRs to upstream
- Must create PR manually via web interface
- Use URL format: `https://github.com/beamlens/beamlens/compare/main...bradleygolden:ralph/issue-N-pr`
- Reference issue in PR title
- Include comprehensive description with summary, changes, testing, and impact

## Learnings

### Documentation Guidance (from PR #24 review)
- Document intent and patterns, not implementation details
- Avoid prescriptive step-by-step instructions - LLMs can infer from guidance
- Hard-coding deterministic steps is a code smell
- Let LLMs synthesize insights rather than following recipes
- Only use determinism where inference is 100% not needed

### Git Configuration
- Author: `bradleygolden <bradleygolden@users.noreply.github.com>`
- No Co-Authored-By attributes in commits
- Use `git commit --amend --reset-author` if author needs correction

### Testing Philosophy
- No @spec annotations
- No Process.sleep in tests - use deterministic logic
- Avoid tautological or disjunctive assertions
- Each test should assert exactly one expected outcome
- Never use case statements in test assertions for different outcomes

### Zero Production Impact
- All calls must be read-only with no side effects
- Never analyze or expose PII/PHI
- Use Process.info/2, :erlang.memory/0, System Monitor events
- ETS table introspection is safe (read-only)

### Elixir/OTP Patterns (Issue #16)
- Use pattern matching over conditionals where possible
- Refactor nested case statements to stay within Credo depth limit (max 2)
- Dialyzer requires specific patterns - avoid overly broad guards
- Rescue clauses are better than catch for error handling
- Split complex logic into helper functions to improve readability

### Code Review Best Practices (2026-01-22)
When blocked on state limits with open PRs:
1. Check CI status via gh CLI for both PRs
2. Review PR comments and feedback
3. Conduct thorough code review:
   - Check AGENTS.md convention compliance (no @spec, no Process.sleep)
   - Verify test coverage and quality
   - Look for edge cases and potential bugs
   - Compare with similar implementations in codebase
   - Check documentation for prescriptive patterns
4. Run full test suite, Credo, and Dialyzer
5. Update memory with review findings
6. If improvements found: implement, test, push
7. If PRs are solid: document findings and wait
